#### 理解原子锁需要足够了解C++的内存相关
#### Memory coherence and memory consistency
consistency 和 coherence 的中文翻译近似，但这两个内存储存模型实际差别较大

coherence 保证了大家看到的内存是一致的  
关注在发生了什么事件后，写的数据对他人可见  
定义了一个读操作能获得什么样的值  
consistent 说一个处理器对不同数据的读写，在其他不同的处理器看来是否满足某些性质  
关注的是所有人对某个人对同一个变量的读写是否满足某种性质  
定义了何时一个写操作的值会被读操作获得   

满足如下三个条件的内存系统是为coherent
1. 对于同一地址 X, 若处理器 P 在写后读，并且在 P 的写后没有别的处理器写 X，那么 P 的读总是能返回 P 写入的值。条件1要求系统提供我们在单处理器中已熟知的程序次序(program order)。
2. 处理器 P1 完成对 X 的写后，P2 读 X. 如果两者之间相隔时间足够长，并且没有其他处理器写 X, 那么 P2 可以获得 P1 写入的值。条件2要求写结果最终对别的处理器可见。
3. 对同一地址的写操作是串行的(serialized), 在所有处理器看来，通过不同处理器对X的写操作都是以相同次序进行的。举个例子，如果值 1 先被写入，值 2 后被写入，那么处理器不能先读到值 2, 然后再读到值 1.性质3要求系统提供写串行化(write serialization). 若这一性质不被满足，程序错误可能会被引发：考虑 P1 先写 P2 后写的情况，如果存在一些处理器先看到P2的写结果，后看到 P1 的值，那么这个处理器将无限期地保持P1写入的值



#### 整理来源
https://zhuanlan.zhihu.com/p/58589781 
https://www.zhihu.com/question/24301047/answer/83422523